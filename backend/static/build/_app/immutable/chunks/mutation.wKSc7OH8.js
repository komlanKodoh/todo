class E{constructor(){this.listeners=[]}subscribe(e){const s=e||(()=>{});return this.listeners.push(s),this.onSubscribe(),()=>{this.listeners=this.listeners.filter(r=>r!==s),this.onUnsubscribe()}}hasListeners(){return this.listeners.length>0}onSubscribe(){}onUnsubscribe(){}}const P=typeof window>"u";function g(){}function X(t,e){return typeof t=="function"?t(e):t}function Y(t){return typeof t=="number"&&t>=0&&t!==1/0}function O(t){return Array.isArray(t)?t:[t]}function Z(t,e){return Math.max(t+(e||0)-Date.now(),0)}function $(t,e,s){return y(t)?typeof e=="function"?Object.assign(Object.assign({},s),{queryKey:t,queryFn:e}):Object.assign(Object.assign({},e),{queryKey:t}):t}function ee(t,e,s){return y(t)?typeof e=="function"?Object.assign(Object.assign({},s),{mutationKey:t,mutationFn:e}):Object.assign(Object.assign({},e),{mutationKey:t}):typeof t=="function"?Object.assign(Object.assign({},e),{mutationFn:t}):Object.assign({},t)}function te(t,e,s){return y(t)?[Object.assign(Object.assign({},e),{queryKey:t}),s]:[t||{},e]}function K(t,e){return t===!0&&e===!0||t==null&&e==null?"all":t===!1&&e===!1?"none":t??!e?"active":"inactive"}function se(t,e){const{active:s,exact:r,fetching:n,inactive:i,predicate:l,queryKey:c,stale:u}=t;if(y(c)){if(r){if(e.queryHash!==R(c,e.options))return!1}else if(!S(e.queryKey,c))return!1}const h=K(s,i);if(h==="none")return!1;if(h!=="all"){const d=e.isActive();if(h==="active"&&!d||h==="inactive"&&d)return!1}return!(typeof u=="boolean"&&e.isStale()!==u||typeof n=="boolean"&&e.isFetching()!==n||l&&!l(e))}function ne(t,e){const{exact:s,fetching:r,predicate:n,mutationKey:i}=t;if(y(i)){if(!e.options.mutationKey)return!1;if(s){if(j(e.options.mutationKey)!==j(i))return!1}else if(!S(e.options.mutationKey,i))return!1}return!(typeof r=="boolean"&&e.state.status==="loading"!==r||n&&!n(e))}function R(t,e){return((e==null?void 0:e.queryKeyHashFn)||j)(t)}function j(t){const e=O(t);return q(e)}function q(t){return JSON.stringify(t,(e,s)=>w(s)?Object.keys(s).sort().reduce((r,n)=>(r[n]=s[n],r),{}):s)}function S(t,e){return x(O(t),O(e))}function x(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(s=>!x(t[s],e[s])):!1}function D(t,e){if(t===e)return t;const s=Array.isArray(t)&&Array.isArray(e);if(s||w(t)&&w(e)){const r=s?t.length:Object.keys(t).length,n=s?e:Object.keys(e),i=n.length,l=s?[]:{};let c=0;for(let u=0;u<i;u++){const h=s?u:n[u];l[h]=D(t[h],e[h]),l[h]===t[h]&&c++}return r===i&&c===r?t:l}return e}function ie(t,e){if(t&&!e||e&&!t)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}function w(t){if(!F(t))return!1;const e=t.constructor;if(typeof e>"u")return!0;const s=e.prototype;return!(!F(s)||!s.hasOwnProperty("isPrototypeOf"))}function F(t){return Object.prototype.toString.call(t)==="[object Object]"}function y(t){return typeof t=="string"||Array.isArray(t)}function N(t){return new Promise(e=>{setTimeout(e,t)})}function _(t){Promise.resolve().then(t).catch(e=>setTimeout(()=>{throw e}))}function re(){if(typeof AbortController=="function")return new AbortController}class Q extends E{constructor(){super(),this.setup=e=>{if(!P&&(window!=null&&window.addEventListener)){const s=()=>e();return window.addEventListener("visibilitychange",s,!1),window.addEventListener("focus",s,!1),()=>{window.removeEventListener("visibilitychange",s),window.removeEventListener("focus",s)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){var e;this.hasListeners()||((e=this.cleanup)===null||e===void 0||e.call(this),this.cleanup=void 0)}setEventListener(e){var s;this.setup=e,(s=this.cleanup)===null||s===void 0||s.call(this),this.cleanup=e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()})}setFocused(e){this.focused=e,e&&this.onFocus()}onFocus(){this.listeners.forEach(e=>{e()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const U=new Q;class k extends E{constructor(){super(),this.setup=e=>{if(!P&&(window!=null&&window.addEventListener)){const s=()=>e();return window.addEventListener("online",s,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",s)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){var e;this.hasListeners()||((e=this.cleanup)===null||e===void 0||e.call(this),this.cleanup=void 0)}setEventListener(e){var s;this.setup=e,(s=this.cleanup)===null||s===void 0||s.call(this),this.cleanup=e(r=>{typeof r=="boolean"?this.setOnline(r):this.onOnline()})}setOnline(e){this.online=e,e&&this.onOnline()}onOnline(){this.listeners.forEach(e=>{e()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const I=new k;function T(t){return Math.min(1e3*2**t,3e4)}function C(t){return typeof(t==null?void 0:t.cancel)=="function"}class A{constructor(e){this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}}function oe(t){return t instanceof A}class H{constructor(e){let s=!1,r,n,i,l;this.abort=e.abort,this.cancel=a=>r==null?void 0:r(a),this.cancelRetry=()=>{s=!0},this.continueRetry=()=>{s=!1},this.continue=()=>n==null?void 0:n(),this.failureCount=0,this.isPaused=!1,this.isResolved=!1,this.isTransportCancelable=!1,this.promise=new Promise((a,o)=>{i=a,l=o});const c=a=>{var o;this.isResolved||(this.isResolved=!0,(o=e.onSuccess)===null||o===void 0||o.call(e,a),n==null||n(),i(a))},u=a=>{var o;this.isResolved||(this.isResolved=!0,(o=e.onError)===null||o===void 0||o.call(e,a),n==null||n(),l(a))},h=()=>new Promise(a=>{var o;n=a,this.isPaused=!0,(o=e.onPause)===null||o===void 0||o.call(e)}).then(()=>{var a;n=void 0,this.isPaused=!1,(a=e.onContinue)===null||a===void 0||a.call(e)}),d=()=>{if(this.isResolved)return;let a;try{a=e.fn()}catch(o){a=Promise.reject(o)}r=o=>{var f;if(!this.isResolved&&(u(new A(o)),(f=this.abort)===null||f===void 0||f.call(this),C(a)))try{a.cancel()}catch{}},this.isTransportCancelable=C(a),Promise.resolve(a).then(c).catch(o=>{var f,b,p;if(this.isResolved)return;const v=(f=e.retry)!==null&&f!==void 0?f:3,m=(b=e.retryDelay)!==null&&b!==void 0?b:T,L=typeof m=="function"?m(this.failureCount,o):m,M=v===!0||typeof v=="number"&&this.failureCount<v||typeof v=="function"&&v(this.failureCount,o);if(s||!M){u(o);return}this.failureCount++,(p=e.onFail)===null||p===void 0||p.call(e,this.failureCount,o),N(L).then(()=>{if(!U.isFocused()||!I.isOnline())return h()}).then(()=>{s?u(o):d()})})};d()}}class V{constructor(){this.queue=[],this.transactions=0,this.notifyFn=e=>{e()},this.batchNotifyFn=e=>{e()}}batch(e){let s;this.transactions++;try{s=e()}finally{this.transactions--,this.transactions||this.flush()}return s}schedule(e){this.transactions?this.queue.push(e):_(()=>{this.notifyFn(e)})}batchCalls(e){return(...s)=>{this.schedule(()=>{e(...s)})}}flush(){const e=this.queue;this.queue=[],e.length&&_(()=>{this.batchNotifyFn(()=>{e.forEach(s=>{this.notifyFn(s)})})})}setNotifyFunction(e){this.notifyFn=e}setBatchNotifyFunction(e){this.batchNotifyFn=e}}const z=new V;let B=console;function J(){return B}class ae{constructor(e){this.options=Object.assign(Object.assign({},e.defaultOptions),e.options),this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.observers=[],this.state=e.state||G(),this.meta=e.meta}setState(e){this.dispatch({type:"setState",state:e})}addObserver(e){this.observers.indexOf(e)===-1&&this.observers.push(e)}removeObserver(e){this.observers=this.observers.filter(s=>s!==e)}cancel(){return this.retryer?(this.retryer.cancel(),this.retryer.promise.then(g).catch(g)):Promise.resolve()}continue(){return this.retryer?(this.retryer.continue(),this.retryer.promise):this.execute()}execute(){let e;const s=this.state.status==="loading";let r=Promise.resolve();return s||(this.dispatch({type:"loading",variables:this.options.variables}),r=r.then(()=>{var n,i;(i=(n=this.mutationCache.config).onMutate)===null||i===void 0||i.call(n,this.state.variables,this)}).then(()=>{var n,i;return(i=(n=this.options).onMutate)===null||i===void 0?void 0:i.call(n,this.state.variables)}).then(n=>{n!==this.state.context&&this.dispatch({type:"loading",context:n,variables:this.state.variables})})),r.then(()=>this.executeMutation()).then(n=>{var i,l;e=n,(l=(i=this.mutationCache.config).onSuccess)===null||l===void 0||l.call(i,e,this.state.variables,this.state.context,this)}).then(()=>{var n,i;return(i=(n=this.options).onSuccess)===null||i===void 0?void 0:i.call(n,e,this.state.variables,this.state.context)}).then(()=>{var n,i;return(i=(n=this.options).onSettled)===null||i===void 0?void 0:i.call(n,e,null,this.state.variables,this.state.context)}).then(()=>(this.dispatch({type:"success",data:e}),e)).catch(n=>{var i,l;return(l=(i=this.mutationCache.config).onError)===null||l===void 0||l.call(i,n,this.state.variables,this.state.context,this),J().error(n),Promise.resolve().then(()=>{var c,u;return(u=(c=this.options).onError)===null||u===void 0?void 0:u.call(c,n,this.state.variables,this.state.context)}).then(()=>{var c,u;return(u=(c=this.options).onSettled)===null||u===void 0?void 0:u.call(c,void 0,n,this.state.variables,this.state.context)}).then(()=>{throw this.dispatch({type:"error",error:n}),n})})}executeMutation(){var e;return this.retryer=new H({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:()=>{this.dispatch({type:"failed"})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(e=this.options.retry)!==null&&e!==void 0?e:0,retryDelay:this.options.retryDelay}),this.retryer.promise}dispatch(e){this.state=W(this.state,e),z.batch(()=>{this.observers.forEach(s=>{s.onMutationUpdate(e)}),this.mutationCache.notify(this)})}}function G(){return{context:void 0,data:void 0,error:null,failureCount:0,isPaused:!1,status:"idle",variables:void 0}}function W(t,e){switch(e.type){case"failed":return Object.assign(Object.assign({},t),{failureCount:t.failureCount+1});case"pause":return Object.assign(Object.assign({},t),{isPaused:!0});case"continue":return Object.assign(Object.assign({},t),{isPaused:!1});case"loading":return Object.assign(Object.assign({},t),{context:e.context,data:void 0,error:null,isPaused:!1,status:"loading",variables:e.variables});case"success":return Object.assign(Object.assign({},t),{data:e.data,error:null,status:"success",isPaused:!1});case"error":return Object.assign(Object.assign({},t),{data:void 0,error:e.error,failureCount:t.failureCount+1,isPaused:!1,status:"error"});case"setState":return Object.assign(Object.assign({},t),e.state);default:return t}}export{ae as M,H as R,E as S,oe as a,J as b,z as c,ne as d,O as e,X as f,re as g,R as h,Y as i,C as j,U as k,$ as l,se as m,g as n,I as o,te as p,j as q,D as r,S as s,Z as t,P as u,ie as v,G as w,ee as x};
